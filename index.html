<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GACOR EXPRESS</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{background:#f2f4f7}
.app{max-width:420px;margin:auto;background:#fff;min-height:100vh}
.header{background:linear-gradient(135deg,#0d6efd,#20c997);color:#fff;padding:15px}
.menu-item{background:#f8f9fa;border-radius:15px;padding:15px;text-align:center;cursor:pointer}
.menu-item i{font-size:28px}
#map{height:300px;border-radius:10px}
</style>
</head>

<body>

<div class="app">

<div class="header">
<h5 class="fw-bold mb-0">GACOR EXPRESS</h5>
<small>Ojek Online & Antar Makanan<br>Area Long Ikis</small>
</div>

<img src="banner.jpg" class="img-fluid">

<div class="p-3">
<div class="row g-3 text-center">
    <div class="col-4">
        <div class="menu-item" onclick="openOrder('Ojek Online')">
            <i class="bi bi-bicycle text-primary"></i>
            <div>Ojek</div>
        </div>
    </div>
    <div class="col-4">
        <div class="menu-item" onclick="openOrder('Food Delivery')">
            <i class="bi bi-bag-heart text-success"></i>
            <div>Food</div>
        </div>
    </div>
    <div class="col-4">
        <div class="menu-item" onclick="openOrder('Jastip')">
            <i class="bi bi-box-seam text-warning"></i>
            <div>Jastip</div>
        </div>
    </div>
</div>
</div>

</div>

<!-- MODAL -->
<div class="modal fade" id="orderModal">
<div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
<div class="modal-content">

<div class="modal-header">
<h5 class="modal-title">Form Pemesanan</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">

<div class="mb-2">
<label>Nama Pemesan</label>
<input id="nama" class="form-control">
</div>

<div class="mb-2">
<label>Layanan</label>
<input id="layanan" class="form-control" readonly>
</div>

<div class="mb-2">
<label>Jemput</label>
<input id="jemput" class="form-control" readonly>
</div>

<div class="mb-2">
<label>Antar (Tap Peta)</label>
<input id="antar" class="form-control" readonly>
</div>

<div class="mb-2">
<label>Tarif</label>
<input id="tarif" class="form-control fw-bold" readonly>
</div>

<div id="map"></div>

<button class="btn btn-success w-100 mt-3" onclick="kirimWA()">
<i class="bi bi-whatsapp"></i> Kirim Pesanan
</button>

</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let modal = new bootstrap.Modal(document.getElementById('orderModal'));
let map, jemputMarker, antarMarker;
let lat1, lon1;

// buka form
function openOrder(service){
    document.getElementById('layanan').value = service;
    modal.show();
    setTimeout(initMap,500);
}

// init map
function initMap(){
    if(map) return;

    map = L.map('map').setView([0,0], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        attribution:'Â© OpenStreetMap'
    }).addTo(map);

    navigator.geolocation.getCurrentPosition(pos=>{
        lat1 = pos.coords.latitude;
        lon1 = pos.coords.longitude;

        map.setView([lat1,lon1],16);
        jemputMarker = L.marker([lat1,lon1]).addTo(map).bindPopup("Titik Jemput").openPopup();
        document.getElementById('jemput').value = lat1+', '+lon1;
    });

    map.on('click', function(e){
        if(antarMarker) map.removeLayer(antarMarker);
        antarMarker = L.marker(e.latlng).addTo(map).bindPopup("Tujuan").openPopup();

        document.getElementById('antar').value = e.latlng.lat+', '+e.latlng.lng;

        let jarak = hitungJarak(lat1,lon1,e.latlng.lat,e.latlng.lng);
        let tarif = hitungTarif(jarak);
        document.getElementById('tarif').value = 'Rp ' + tarif.toLocaleString();
    });
}

// hitung jarak
function hitungJarak(lat1,lon1,lat2,lon2){
    const R = 6371;
    const dLat = (lat2-lat1)*Math.PI/180;
    const dLon = (lon2-lon1)*Math.PI/180;
    const a =
      Math.sin(dLat/2)*Math.sin(dLat/2) +
      Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) *
      Math.sin(dLon/2)*Math.sin(dLon/2);
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}

// hitung tarif
function hitungTarif(jarak){
    let tarif = 9000;
    if(jarak > 1){
        let sisa = (jarak-1)*1000;
        if(sisa < 500) sisa = 1000;
        else sisa = Math.ceil(sisa/1000)*1000;
        tarif += sisa;
    }
    return tarif;
}

// kirim ke WA
function kirimWA(){
    let text =
`Nama: ${nama.value}
Layanan: ${layanan.value}
Jemput: ${jemput.value}
Antar: ${antar.value}
Tarif: ${tarif.value}`;

    window.open(
        `https://wa.me/6282154306353?text=${encodeURIComponent(text)}`,
        '_blank'
    );
}
</script>

</body>
</html>
